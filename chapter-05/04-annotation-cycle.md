# 5.4 주석 사이클

> plan.md에 인라인 주석을 추가하고, Claude에게 반영을 요청하는 과정을 반복하여 완성도 높은 계획을 만듭니다.

> 🎯 **이 섹션에서 배울 Claude Code 기능**: 인라인 주석 기반 계획 수정, 반복적 문서 협업

> ⭐⭐⭐ **난이도**: 어려움

## 학습 목표

- plan.md에 인라인 메모(`NOTE:`, `CHANGE:`, `REJECT:`)를 추가하는 방법을 배웁니다
- Claude에게 메모를 반영하여 계획을 업데이트하도록 요청하는 기법을 익힙니다
- 만족할 때까지 반복하는 주석 사이클의 가치를 이해합니다
- 최종 승인 후 세부 작업 목록을 생성하는 방법을 배웁니다

## 주석 사이클이란?

**이것이 Boris Tane 워크플로의 가장 독특한 부분입니다.**

대부분의 AI 워크플로에서는 AI의 계획을 "좋아" 또는 "별로야"로만 피드백합니다. 하지만 주석 사이클에서는 **계획 문서에 직접 인라인 메모를 작성**하여 구체적인 피드백을 전달합니다.

```
일반적인 피드백:       "계획이 좀 별로야. 다시 해줘."
주석 사이클 피드백:     plan.md의 17번째 줄에 "NOTE: 이 쿼리는 N+1 문제가
                       있어. LEFT JOIN 방식으로 변경해줘"
```

### 왜 인라인 메모인가?

- **정확한 위치 지정**: 어떤 부분이 문제인지 Claude가 즉시 파악
- **구체적인 피드백**: "별로야"가 아닌 "이것을 이렇게 바꿔줘"
- **검토 흔적 남기기**: 왜 그런 결정을 했는지 기록으로 남음
- **컨텍스트 효율**: Claude는 전체 plan.md의 맥락을 가지고 있으므로 짧은 메모로도 의도 전달 가능

## 메모 접두사 규칙

| 접두사 | 의미 | 사용 시기 |
|--------|------|----------|
| `NOTE:` | 정보 추가/수정 | 부정확한 정보를 바로잡을 때 |
| `CHANGE:` | 접근 방식 변경 요청 | 다른 구현 방식을 원할 때 |
| `REJECT:` | 해당 부분 거부 | 전혀 다른 방향을 원할 때 |

{% hint style="tip" %}
메모는 **간결하게** 작성하세요. Claude는 plan.md의 전체 컨텍스트를 가지고 있으므로, 긴 설명 없이도 짧은 메모만으로 의도를 파악할 수 있습니다.
{% endhint %}

## 실습: plan.md에 주석 추가하기

### Step 1: plan.md를 에디터에서 열고 검토

VS Code 또는 사용하는 에디터에서 plan.md를 열고, 각 섹션을 꼼꼼히 검토합니다. 다음과 같은 관점으로 검토하세요:

- **가정이 틀린 부분**: 실제 코드와 다른 가정을 하고 있는 곳
- **더 나은 접근이 있는 부분**: 경험상 다른 방법이 더 좋은 곳
- **빠진 내용**: 고려하지 않은 엣지 케이스나 요구사항
- **불필요한 내용**: 과도하게 복잡하거나 필요 없는 부분

### Step 2: 인라인 메모 추가 — 3가지 시나리오

#### 시나리오 1: 정보 수정 (NOTE:)

plan.md에서 쿼리 함수의 반환 타입이 실제와 다른 경우:

```markdown
### getCompletionStats()
```ts
export async function getCompletionStats() {
  // 전체 완료율 + 이번 주 완료율
  // Returns: { total: number, completed: number, rate: number,
  //            weekTotal: number, weekCompleted: number, weekRate: number }
}
```
NOTE: 이번 주의 기준은 월요일~일요일로 해줘. JavaScript의 getDay()는 일요일이 0이니까 주의해줘.
```

#### 시나리오 2: 접근 방식 변경 (CHANGE:)

차트 구현 방식을 변경하고 싶은 경우:

```markdown
## 접근 방식
- Tailwind CSS만으로 차트 구현 (외부 라이브러리 없음)

CHANGE: 카테고리별 바 차트와 주간 추이는 Tailwind로 충분하지만, 우선순위별 분포는 원형 비율로 보여주고 싶어. CSS로 도넛 차트 스타일(conic-gradient)을 사용해줘.
```

#### 시나리오 3: 접근 거부 (REJECT:)

생산성 점수 계산 로직이 너무 복잡한 경우:

```markdown
### getProductivityScore()
```ts
export async function getProductivityScore() {
  // 완료율 × 40 + 이번 주 완료율 × 30 + 기한 준수율 × 30
  // Returns: { score: number, breakdown: {...} }
}
```
REJECT: 기한 준수율 계산은 너무 복잡해. 단순하게 완료율 × 60 + 이번 주 완료율 × 40으로 해줘. 0~100 사이 정수로 반올림.
```

### Step 3: Claude에게 메모 반영 요청

메모를 추가한 뒤, Claude에게 반영을 요청합니다.

→ *이 프롬프트는 plan.md에 추가한 인라인 메모들을 Claude가 처리하고, 계획을 업데이트하도록 요청하기 위한 것입니다:*

```
plan.md에 메모를 추가했어. 모든 NOTE:, CHANGE:, REJECT: 메모를 처리하고 계획을 업데이트해줘. 메모를 처리한 후에는 해당 메모를 삭제하고 반영된 내용으로 교체해줘. 아직 구현하지 마.
```

{% hint style="warning" %}
**"아직 구현하지 마"를 다시 한번 포함하세요.** Claude는 계획을 업데이트한 후 자연스럽게 구현으로 넘어가려 할 수 있습니다. 주석 사이클이 끝날 때까지 이 지시를 매번 포함하는 것이 안전합니다.
{% endhint %}

### Step 4: 반복 (1~3회)

Claude가 업데이트한 plan.md를 다시 검토합니다. 아직 불만족스러운 부분이 있으면 Step 2~3을 반복합니다.

**1회차 검토**: 큰 방향 수정 (접근 방식, 아키텍처)
**2회차 검토**: 세부 사항 수정 (타입, 네이밍, 엣지 케이스)
**3회차 검토**: 미세 조정 (코드 스타일, 주석, 순서)

일반적으로 2~3회면 만족스러운 계획이 만들어집니다.

```
┌────────────┐     메모 추가     ┌────────────┐
│ plan.md    │ ──────────────► │ Claude     │
│ 검토       │                  │ 메모 반영   │
│            │ ◄────────────── │ 계획 업데이트│
│ 다시 검토   │    업데이트된     └────────────┘
│            │    plan.md
└────────────┘
     │
     │ 만족?
     │
  ┌──┴──┐
  │ Yes │ → Step 5로 진행
  │ No  │ → Step 2로 돌아가기
  └─────┘
```

### Step 5: 최종 승인 및 작업 목록 요청

plan.md에 만족하면 최종 승인하고, 구현할 작업을 세분화된 할 일 목록으로 만들어달라고 요청합니다.

→ *이 프롬프트는 승인된 계획을 세분화된 작업 목록으로 변환하여, 구현 단계에서 순서대로 진행할 수 있게 하기 위한 것입니다:*

```
계획이 좋아. 이제 구현할 작업을 세분화된 할 일 목록으로 만들어줘. 각 작업은:
- 구현 순서대로 정렬
- 의존성이 있는 경우 표시
- 예상되는 변경 파일 포함

plan.md의 하단에 "## 구현 작업 목록" 섹션으로 추가해줘.
```

Claude가 추가하는 작업 목록 예시:

```markdown
## 구현 작업 목록

### Phase 1: 쿼리 함수 (의존성 없음)
- [ ] lib/queries/stats.ts 생성
- [ ] getCompletionStats() 구현
- [ ] getCategoryDistribution() 구현
- [ ] getPriorityDistribution() 구현
- [ ] getWeeklyTrend() 구현
- [ ] getProductivityScore() 구현

### Phase 2: UI 컴포넌트 (Phase 1 완료 후)
- [ ] components/stats/completion-cards.tsx 생성
- [ ] components/stats/category-chart.tsx 생성
- [ ] components/stats/priority-chart.tsx 생성
- [ ] components/stats/weekly-trend.tsx 생성
- [ ] components/stats/productivity-score.tsx 생성

### Phase 3: 페이지 조립 (Phase 1, 2 완료 후)
- [ ] app/stats/page.tsx 생성
- [ ] 네비게이션에 /stats 링크 추가

### Phase 4: 검증
- [ ] pnpm build 통과 확인
- [ ] 브라우저에서 /stats 페이지 동작 확인
- [ ] 데이터가 없는 경우 빈 상태 처리 확인
```

## 주석 사이클 실전 팁

### 1. 메모는 간결하게

```
❌ "이 쿼리 함수는 N+1 문제가 있을 수 있습니다. 왜냐하면 각 카테고리에 대해
    별도로 쿼리를 실행하면 카테고리 수만큼 DB 호출이 발생하기 때문입니다.
    이를 해결하려면 단일 GROUP BY 쿼리를 사용해야 합니다."

✅ "NOTE: N+1 문제. 단일 GROUP BY 쿼리로 변경해줘."
```

Claude는 plan.md의 전체 컨텍스트를 가지고 있으므로, 짧은 메모만으로도 정확히 이해합니다.

### 2. 거부할 때는 대안을 제시

```
❌ "REJECT: 이 접근은 안 돼."

✅ "REJECT: 이 접근은 안 돼. 대신 CSS conic-gradient로 도넛 차트를 만들어줘."
```

대안을 제시하면 Claude가 바로 올바른 방향으로 수정할 수 있습니다.

### 3. 모든 메모를 한 번에 추가

한 번의 검토에서 발견한 모든 메모를 한꺼번에 추가하고, 한 번에 반영을 요청하세요. 메모 하나씩 따로 요청하면 불필요하게 대화 턴이 늘어납니다.

### 4. 메모가 더 이상 없으면 과감하게 승인

완벽한 계획은 없습니다. 큰 방향이 맞고 세부 사항이 대체로 타당하면 승인하세요. 구현 단계에서도 수정할 수 있습니다.

## 핵심 정리

| 개념 | 설명 |
|------|------|
| 주석 사이클 | plan.md에 인라인 메모 추가 → Claude에게 반영 요청 → 반복 |
| NOTE: | 정보 추가/수정 — 부정확한 내용 바로잡기 |
| CHANGE: | 접근 방식 변경 — 다른 구현 방식 요청 |
| REJECT: | 부분 거부 — 대안 제시와 함께 사용 |
| 반복 횟수 | 일반적으로 2~3회면 충분 |
| 최종 승인 | 만족 시 작업 목록 요청으로 전환 |

---

## ✅ 체크포인트

이 섹션을 완료하면 다음을 확인하세요:

- [ ] plan.md에 NOTE:, CHANGE:, REJECT: 메모를 추가함
- [ ] Claude에게 메모 반영을 요청하고 계획이 업데이트됨
- [ ] 1~3회 반복 후 만족스러운 계획이 완성됨
- [ ] plan.md 하단에 구현 작업 목록이 추가됨
- [ ] "아직 구현하지 마" 지시를 매 요청에 포함했음

---

> **다음**: [5.5 구현 단계](05-implementation.md)에서 승인된 계획을 기반으로 일괄 구현을 수행하고, 결과를 테스트합니다.
