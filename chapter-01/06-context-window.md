# 1.6 컨텍스트 창 개념

> Claude Code의 컨텍스트 윈도우를 이해하고, 효과적으로 관리하는 방법을 학습합니다.

> 🎯 **이 섹션에서 배울 Claude Code 기능**: `/clear`, `/compact`, `/rewind` + Summarize, 서브에이전트

> ⭐ **난이도**: 쉬움

## 개요

Claude Code를 사용할 때 가장 중요한 리소스는 **컨텍스트 윈도우(Context Window)**입니다. 공식 문서에서도 "대부분의 베스트 프랙티스는 하나의 제약 조건에 기반합니다: Claude의 컨텍스트 윈도우가 빠르게 차며, 차면 성능이 저하됩니다"라고 강조하고 있습니다. 이 섹션에서는 컨텍스트 윈도우의 개념과 관리 방법을 학습합니다.

## 컨텍스트 윈도우란?

컨텍스트 윈도우는 Claude가 한 번에 "기억"할 수 있는 정보의 총량입니다.

> 💡 **비유**: 컨텍스트 윈도우는 **책상 위의 공간**과 같습니다. 책상이 넓을수록 많은 자료를 펼쳐놓을 수 있지만, 한계가 있습니다. 자료가 너무 많아지면 필요한 것을 찾기 어려워지고, 결국 책상을 정리(`/clear`)하거나 자료를 요약(`/compact`)해야 합니다.

여기에는 다음이 모두 포함됩니다:

| 포함 항목 | 예시 |
|-----------|------|
| 전체 대화 내용 | 여러분의 프롬프트와 Claude의 응답 |
| 읽은 파일 내용 | Claude가 읽은 소스 코드, 설정 파일 |
| 명령 실행 결과 | `pnpm build`, `git status` 등의 출력 |
| CLAUDE.md 내용 | 프로젝트 규칙과 컨텍스트 |

하나의 디버깅 세션이나 코드베이스 탐색에서 수만 개의 토큰이 소비될 수 있습니다.

## 왜 중요한가?

컨텍스트 윈도우가 차오르면 다음과 같은 문제가 발생합니다:

1. **지시사항 "망각"**: 초기에 주어진 지시사항을 잊어버릴 수 있습니다.
2. **실수 증가**: 이전 대화의 맥락을 놓쳐 잘못된 코드를 생성합니다.
3. **성능 저하**: 응답 품질이 전반적으로 낮아집니다.
4. **무관한 정보 참조**: 현재 작업과 관련 없는 이전 대화를 참조합니다.

## 관리 방법

### 1. /clear - 컨텍스트 완전 초기화

가장 기본적이고 효과적인 방법입니다. 서로 관련 없는 작업 사이에 반드시 사용하세요.

```
/clear
```

**사용 시점:**
- 인증 설정을 마치고 데이터베이스 작업으로 전환할 때
- 한 파일 작업을 마치고 다른 파일로 넘어갈 때
- 2번 이상 같은 수정을 시도했지만 실패했을 때

{% hint style="info" %}
**공식 문서 권장**: "같은 문제에 대해 2번 이상 수정을 시도해 실패했다면 `/clear`를 실행하고, 실패에서 배운 점을 반영한 더 구체적인 프롬프트로 새로 시작하세요. 깨끗한 세션에서 좋은 프롬프트가 수정 사항이 쌓인 긴 세션보다 거의 항상 나은 결과를 냅니다."
{% endhint %}

### 2. /compact - 대화 요약 압축

대화 전체를 지우지 않고 요약하여 공간을 확보합니다. 특정 내용에 집중하도록 지시할 수 있습니다.

```
/compact
```

초점을 맞출 주제를 지정할 수도 있습니다:

```
/compact API 변경사항에 집중
```

```
/compact 데이터베이스 스키마 관련 내용만 보존
```

### /clear vs /compact 비교

| | `/clear` | `/compact` |
|---|---------|-----------|
| **동작** | 대화 내용 완전 삭제 | 대화 내용을 요약하여 압축 |
| **이전 맥락** | 모두 사라짐 | 요약된 형태로 보존 |
| **사용 시점** | 완전히 새로운 작업 시작 | 같은 작업 계속하면서 공간 확보 |
| **비유** | 책상을 완전히 치우기 | 자료를 정리하여 요약본만 남기기 |

### 3. /rewind + Summarize from here - 부분 요약

대화의 특정 시점부터 현재까지만 요약하고 싶을 때 사용합니다.

1. `Esc`를 두 번 누르거나 `/rewind`를 입력합니다.
2. 체크포인트 목록에서 요약 시작점을 선택합니다.
3. **Summarize from here**를 선택합니다.

이 방법은 선택한 시점 이후의 메시지만 압축하고, 그 이전의 컨텍스트는 그대로 유지합니다.

### 4. 서브에이전트 활용

탐색 작업을 별도의 컨텍스트에서 실행하여 메인 대화를 깨끗하게 유지합니다.

```
서브에이전트를 사용해서 Todo 앱의 데이터베이스 쿼리 패턴이 어떻게 동작하는지,
현재 어떤 쿼리 함수들이 있는지 조사해줘.
```

서브에이전트는 별도의 컨텍스트 윈도우에서 실행되어 파일을 탐색하고 결과만 요약하여 돌려줍니다. 메인 대화에는 요약만 추가되므로 컨텍스트를 크게 절약할 수 있습니다.

{% hint style="info" %}
**서브에이전트 활용이 효과적인 경우:**
- 코드베이스의 여러 파일을 탐색해야 할 때
- 현재 작업에 참고 정보가 필요하지만 파일 전체를 읽을 필요는 없을 때
- 구현 후 코드 리뷰를 받고 싶을 때
{% endhint %}

### 5. 자동 압축 (Auto-compaction)

컨텍스트가 한도에 가까워지면 Claude Code가 자동으로 대화를 압축합니다. 이때 핵심적인 코드 패턴, 파일 상태, 주요 결정사항을 보존하면서 공간을 확보합니다.

자동 압축 시 보존할 내용을 CLAUDE.md에서 지정할 수 있습니다:

```markdown
# 압축 가이드라인
압축 시 항상 보존할 내용:
- 수정된 파일의 전체 목록
- 테스트 명령어와 결과
- 현재 작업 목표
```

## 실습: CLAUDE.md에 컴팩션 가이드 추가

실제로 CLAUDE.md에 컴팩션 지침을 추가해 봅니다.

Claude Code에서 다음 프롬프트를 입력합니다:

→ *이 프롬프트는 자동 압축 시 보존할 정보를 CLAUDE.md에 기록하기 위한 것입니다:*

```
CLAUDE.md에 다음 섹션을 추가해줘:

## 압축 가이드라인
압축 시 수정된 파일 목록과 테스트 명령어를 보존해줘.
데이터베이스 스키마 변경사항과 API 라우트 정의를 유지하는 데 집중해줘.
```

이렇게 하면 자동 압축이 발생할 때 중요한 정보가 유지됩니다.

## 실습: /compact 직접 체험하기

컨텍스트가 쌓이는 것을 체험하고 `/compact`로 정리해봅니다.

### Step 1: 의도적으로 컨텍스트 쌓기

→ *여러 파일을 읽어서 컨텍스트를 채웁니다:*

```
다음 파일들을 모두 읽고 각각 무슨 내용인지 알려줘:
1. package.json
2. app/layout.tsx
3. db/schema.ts
4. drizzle.config.ts
5. CLAUDE.md
```

### Step 2: /compact로 요약 압축

→ *쌓인 컨텍스트를 요약하여 정리합니다:*

```
/compact 데이터베이스 스키마 관련 내용만 보존
```

`/compact` 후에도 스키마 관련 내용은 기억하고 있지만, 다른 파일의 세부 내용은 요약됩니다.

## 베스트 프랙티스 정리

### 습관화할 패턴

| 상황 | 권장 행동 |
|------|-----------|
| 새로운 작업 시작 | `/clear`로 컨텍스트 초기화 |
| 작업 도중 컨텍스트가 차오름 | `/compact`로 요약 |
| 대규모 탐색이 필요 | 서브에이전트에 위임 |
| 2번 이상 수정 실패 | `/clear` 후 더 구체적인 프롬프트로 재시작 |
| 긴 세션 중 일부 보존 필요 | `/rewind` + Summarize from here |

### 피해야 할 패턴

| 안티패턴 | 문제 | 해결 |
|----------|------|------|
| **부엌 싱크대 세션** | 하나의 세션에서 관련 없는 작업을 계속 수행 | 작업 전환 시 `/clear` |
| **반복 수정** | 같은 수정을 계속 시도하여 실패한 접근으로 컨텍스트 오염 | 2회 실패 후 `/clear`하고 더 나은 프롬프트로 재시작 |
| **끝없는 탐색** | 범위를 정하지 않고 "조사해줘"라고 요청하여 수백 개 파일을 읽음 | 탐색 범위를 좁히거나 서브에이전트 사용 |

## 컨텍스트 관리 워크플로 예시

Todo 앱 프로젝트에서의 실제 워크플로 예시:

```
# 1. 인증 설정 작업 시작
PostgreSQL을 설정하고 데이터베이스를 생성해줘...

# 2. 인증 작업 완료 후 컨텍스트 초기화
/clear

# 3. 데이터베이스 작업 시작 (깨끗한 컨텍스트에서)
PostgreSQL (로컬)와 Drizzle ORM을 설정해줘...

# 4. 데이터베이스 작업 완료 후 컨텍스트 초기화
/clear

# 5. 스키마 설계 시작
Todo 앱의 데이터베이스 스키마를 설계해줘...
```

각 작업이 **깨끗한 컨텍스트에서 시작**되므로 Claude Code가 최적의 성능을 발휘합니다.

## 요약

| 개념 | 핵심 포인트 |
|------|-------------|
| 컨텍스트 윈도우 | 대화 + 파일 + 명령 출력이 모두 포함되는 유한한 공간 |
| /clear | 완전 초기화 - 작업 전환 시 필수 |
| /compact | 요약 압축 - 진행 중인 작업의 공간 확보 |
| /rewind + Summarize | 부분 요약 - 특정 시점 이후만 압축 |
| 서브에이전트 | 별도 컨텍스트에서 탐색 - 메인 대화 보호 |
| 자동 압축 | 한도 도달 시 자동 발동 - CLAUDE.md로 보존 내용 제어 |

---

## ✅ 체크포인트

이 섹션을 완료하면 다음을 확인하세요:

- [ ] 컨텍스트 윈도우의 개념을 이해함 (대화 + 파일 + 명령 출력 = 유한한 공간)
- [ ] `/clear`와 `/compact`의 차이점을 이해함
- [ ] `/compact` 명령을 직접 실행해봄
- [ ] CLAUDE.md에 Compaction Guidelines를 추가함

다음 섹션에서는 [데이터베이스를 설정](07-database-setup.md)합니다.
